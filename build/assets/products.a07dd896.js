import{B as G,r as p,j as s,F as K,a as e,K as L,I as S,H as U,Q as g,bv as Q,bw as J,G as O,a7 as X,bm as Y,bx as Z}from"./index.1b2e2817.js";import{M as P}from"./Modal.3c996469.js";import{u as ee}from"./index.esm.b9680bdc.js";import{c as te,a as E,o as re}from"./object.61533a39.js";import"./upperFirst.293d5b27.js";const ae=te({url:E().required("Product URL is required").url("Please enter a valid URL").test("protocol","URL must start with http:// or https://",t=>t?t.startsWith("http://")||t.startsWith("https://"):!0).max(2048,"URL must not exceed 2048 characters"),title:E().required("Product Title is required").trim().min(3,"Title must be at least 3 characters").max(255,"Title must not exceed 255 characters").test("not-only-spaces","Title cannot be only spaces",t=>t&&t.trim().length>0),shopName:E().required("Shop Name is required").trim().min(2,"Shop Name must be at least 2 characters").max(100,"Shop Name must not exceed 100 characters").test("not-only-spaces","Shop Name cannot be only spaces",t=>t&&t.trim().length>0),price:E().required("Product Price is required").test("is-positive","Price must be greater than 0",t=>{if(!t)return!1;const c=parseFloat(t);return!isNaN(c)&&c>0}).test("max-value","Price must not exceed 999999999.99",t=>{if(!t)return!1;const c=parseFloat(t);return!isNaN(c)&&c<=99999999999e-2}),rating:E().nullable().test("range","Rating must be between 0 and 5",t=>{if(!t||t.trim()==="")return!0;const c=parseFloat(t);return!isNaN(c)&&c>=0&&c<=5}).test("decimal","Rating can have maximum 1 decimal place",t=>{if(!t||t.trim()==="")return!0;const c=t.split(".");return c.length<=2&&(!c[1]||c[1].length<=1)})}).required(),se=({activeModal:t,onClose:c,editingProduct:o=null})=>{const F=G(),[d,N]=p.exports.useState([]),[k,b]=p.exports.useState(""),[R,D]=p.exports.useState(!1),[w,C]=p.exports.useState([]),{register:n,handleSubmit:m,formState:{errors:l},reset:h,setValue:i,watch:f}=ee({resolver:re(ae),mode:"onBlur",defaultValues:{url:"",title:"",shopName:"",price:"",currency:"USD",rating:""}});p.exports.useEffect(()=>{t&&(async()=>{var y;const u=localStorage.getItem("authToken");if(!u){console.warn("\u0422\u043E\u043A\u0435\u043D \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D");return}try{const x=await U.get("https://socialdash.leverageindo.group/api/general/currencies",{headers:{Authorization:u}});((y=x.data)==null?void 0:y.currencies)&&x.data.currencies.length>0&&C(x.data.currencies)}catch(x){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0432\u0430\u043B\u044E\u0442:",x),C(["USD","EUR","RUB"])}})()},[t]),p.exports.useEffect(()=>{w.length>0&&!o&&t&&i("currency",w[0])},[w,o,t,i]),p.exports.useEffect(()=>{var r,u;o?(h({url:o.url||"",title:o.title||"",shopName:o.shopName||"",price:((r=o.price)==null?void 0:r.toString())||"",currency:o.currency||"USD",rating:((u=o.rating)==null?void 0:u.toString())||""}),N(o.images||[])):(h({url:"",title:"",shopName:"",price:"",currency:"USD",rating:""}),N([]),b(""))},[o,t,h]);const j=()=>{k.trim()&&d.length<4&&(N(r=>[...r,k.trim()]),b(""))},B=r=>{N(u=>u.filter((y,x)=>x!==r))},T=async r=>{var y,x,_,$,z,V;if(d.length===0){g.error("Please add at least one product image");return}const u=localStorage.getItem("authToken");if(!u){g.error("Authorization token not found");return}D(!0);try{let A=[];o&&o.photos?A=d.map((v,H)=>{const I=o.photos[H];return{id:(I==null?void 0:I.id)||0,url:v}}):A=d.map(v=>({id:0,url:v}));const M={action:o?"edit":"create",data:{title:r.title.trim(),shop_name:r.shopName.trim(),url:r.url.trim(),currency_key:r.currency,price:parseFloat(r.price)||0,rating:r.rating?parseFloat(r.rating):0,photos:A}};o&&(M.data.id=o.id);const a=(y=(await U.post("https://socialdash.leverageindo.group/api/products/action",M,{headers:{Authorization:u,"Content-Type":"application/json"}})).data)==null?void 0:y.product,W={id:(a==null?void 0:a.id)||(o==null?void 0:o.id),url:(a==null?void 0:a.url)||r.url.trim(),title:(a==null?void 0:a.title)||r.title.trim(),shopName:(a==null?void 0:a.shop_name)||r.shopName.trim(),price:(a==null?void 0:a.price)||parseFloat(r.price)||0,currency:(a==null?void 0:a.currency_key)||r.currency,rating:(a==null?void 0:a.rating)!==void 0?a.rating:r.rating?parseFloat(r.rating):null,images:((x=a==null?void 0:a.photos)==null?void 0:x.map(v=>v.url))||d,photos:(a==null?void 0:a.photos)||A,thumbnail:(($=(_=a==null?void 0:a.photos)==null?void 0:_[0])==null?void 0:$.url)||d[0]};o?(F(Q({id:o.id,...W})),g.success("Product updated successfully")):(F(J(W)),g.success("Product added successfully")),h({url:"",title:"",shopName:"",price:"",currency:"USD",rating:""}),N([]),b(""),c()}catch(A){console.error("Error saving product:",A),g.error(((V=(z=A.response)==null?void 0:z.data)==null?void 0:V.message)||`Failed to ${o?"update":"add"} product`)}finally{D(!1)}},q=()=>{h({url:"",title:"",shopName:"",price:"",currency:"USD",rating:""}),N([]),b(""),c()};return s(K,{children:[e("style",{children:`
        /* \u0421\u043A\u0440\u044B\u0442\u0438\u0435 \u0441\u0442\u0440\u0435\u043B\u043E\u043A \u0443 \u0447\u0438\u0441\u043B\u043E\u0432\u044B\u0445 \u0438\u043D\u043F\u0443\u0442\u043E\u0432 */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
        input[type="number"] {
          -moz-appearance: textfield;
        }
      `}),e(P,{activeModal:t,onClose:q,title:o?"Edit Product":"Add New Product",className:"max-w-2xl max-h-[90vh] bg-[#1A1A1F] dark:bg-[#1A1A1F]",themeClass:"bg-[#1A1A1F] dark:bg-[#1A1A1F]",scrollContent:!0,footerContent:s("div",{className:"flex justify-end gap-3",children:[e(L,{text:"Cancel",className:"bg-transparent border border-slate-300 dark:border-slate-600 text-white px-6 !bg-[#1A1A1F] hover:!bg-[#2a2a30]",onClick:q}),e(L,{text:"Save",className:"bg-white text-slate-900 hover:bg-slate-100 px-6",onClick:m(T),disabled:R})]}),children:s("form",{onSubmit:m(T),className:"space-y-6 text-white",children:[s("div",{children:[s("label",{className:"block mb-2 text-sm font-medium text-white",children:["Product URL ",e("span",{className:"text-red-500",children:"*"})]}),e("input",{type:"url",placeholder:"Enter product URL",...n("url"),className:`w-full px-4 py-3 bg-[#1A1A1F] border rounded-[6px] text-white placeholder:text-slate-500 focus:outline-none focus:ring-2 ${l.url?"border-red-500 focus:ring-red-500":"border-slate-700 focus:ring-primary-500"}`}),l.url&&e("p",{className:"mt-1 text-sm text-red-500",children:l.url.message})]}),s("div",{children:[s("label",{className:"block mb-2 text-sm font-medium text-white",children:["Product Title ",e("span",{className:"text-red-500",children:"*"})]}),e("input",{type:"text",placeholder:"Enter product title",...n("title"),className:`w-full px-4 py-3 bg-[#1A1A1F] border rounded-[6px] text-white placeholder:text-slate-500 focus:outline-none focus:ring-2 ${l.title?"border-red-500 focus:ring-red-500":"border-slate-700 focus:ring-primary-500"}`}),l.title&&e("p",{className:"mt-1 text-sm text-red-500",children:l.title.message})]}),s("div",{children:[s("label",{className:"block mb-2 text-sm font-medium text-white",children:["Shop Name ",e("span",{className:"text-red-500",children:"*"})]}),e("input",{type:"text",placeholder:"Enter Shop Name",...n("shopName"),className:`w-full px-4 py-3 bg-[#1A1A1F] border rounded-[6px] text-white placeholder:text-slate-500 focus:outline-none focus:ring-2 ${l.shopName?"border-red-500 focus:ring-red-500":"border-slate-700 focus:ring-primary-500"}`}),l.shopName&&e("p",{className:"mt-1 text-sm text-red-500",children:l.shopName.message})]}),s("div",{className:"flex gap-4 max-md:flex-wrap",children:[s("div",{className:"flex-1",children:[s("label",{className:"block mb-2 text-sm font-medium text-white",children:["Product Price ",e("span",{className:"text-red-500",children:"*"})]}),s("div",{className:"flex gap-2",children:[e("input",{type:"number",step:"0.01",placeholder:"Enter product price",...n("price"),className:`flex-1 px-4 py-3 max-sm:w-[168px] bg-[#1A1A1F] border rounded-[6px] text-white placeholder:text-slate-500 focus:outline-none focus:ring-2 ${l.price?"border-red-500 focus:ring-red-500":"border-slate-700 focus:ring-primary-500"}`}),s("div",{className:"relative",children:[e("select",{...n("currency"),className:"px-4 py-3 bg-[#1A1A1F] border border-slate-700 rounded-[6px] text-white focus:outline-none focus:ring-2 focus:ring-primary-500 appearance-none pr-[35px] cursor-pointer",children:w.length>0?w.map(r=>e("option",{value:r,children:r},r)):s(K,{children:[e("option",{value:"USD",children:"USD"}),e("option",{value:"EUR",children:"EUR"}),e("option",{value:"RUB",children:"RUB"})]})}),e("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:e("svg",{className:"h-4 w-4 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),l.price&&e("p",{className:"mt-1 text-sm text-red-500",children:l.price.message})]}),s("div",{className:"flex-1",children:[e("label",{className:"block mb-2 text-sm font-medium text-white",children:"Rating"}),e("input",{type:"number",step:"0.1",min:"0",max:"5",placeholder:"Enter Ratings",...n("rating"),className:`w-full min-w-[90px] px-4 py-3 bg-[#1A1A1F] border rounded-[6px] text-white placeholder:text-slate-500 focus:outline-none focus:ring-2 ${l.rating?"border-red-500 focus:ring-red-500":"border-slate-700 focus:ring-primary-500"}`}),l.rating&&e("p",{className:"mt-1 text-sm text-red-500",children:l.rating.message})]})]}),s("div",{children:[s("label",{className:"block mb-2 text-sm font-medium text-white",children:["Product Images (max 4 items)"," ",e("span",{className:"text-red-500",children:"*"})]}),s("div",{className:"flex gap-2 mb-3 max-[440px]:flex-col",children:[e("input",{type:"url",placeholder:"Enter image URL",value:k,onChange:r=>b(r.target.value),onKeyPress:r=>r.key==="Enter"&&j(),className:"flex-1 px-4 py-3 bg-[#1A1A1F] border border-slate-700 rounded-[6px] text-white placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-primary-500"}),e(L,{text:"Add",className:"bg-[#1A1A1F] border border-slate-700 text-white hover:bg-[#2a2a30] px-6",onClick:j,disabled:d.length>=4||!k.trim()})]}),d.length>0&&e("div",{className:"flex flex-wrap gap-2 mt-2",children:d.map((r,u)=>s("div",{className:"relative",children:[e("img",{src:r,alt:`Product ${u+1}`,className:"w-20 h-20 object-cover rounded-[6px] border border-slate-700",onError:y=>{y.target.src="https://via.placeholder.com/80?text=Error"}}),e("button",{type:"button",onClick:()=>B(u),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600",children:e(S,{icon:"heroicons-outline:x",className:"text-sm"})})]},u))})]})]})})]})},de=()=>{O();const t=G();p.exports.useState("");const[c,o]=p.exports.useState(!1),[F,d]=p.exports.useState(null),[N,k]=p.exports.useState(!1),b=X(n=>n.project.products||[]);p.exports.useEffect(()=>{(async()=>{const m=localStorage.getItem("authToken");if(!m){console.warn("\u0422\u043E\u043A\u0435\u043D \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D");return}k(!0);try{const h=(await U.get("https://socialdash.leverageindo.group/api/products",{headers:{Authorization:m}})).data.items.map(i=>({id:i.id,title:i.title,shopName:i.shop_name,url:i.url,currency:i.currency_key,price:i.price,rating:i.rating,images:i.photos.map(f=>f.url),photos:i.photos,thumbnail:i.photos.length>0?i.photos[0].url:null}));t(Y(h))}catch(l){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u043F\u0440\u043E\u0434\u0443\u043A\u0442\u043E\u0432:",l),g.error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u043E\u0434\u0443\u043A\u0442\u043E\u0432")}finally{k(!1)}})()},[t]);const R=()=>{d(null),o(!0)},D=()=>{o(!1),d(null)},w=async n=>{var h,i;const m=localStorage.getItem("authToken");if(!m){g.error("Authorization token not found");return}const l=b.find(f=>f.id===n);if(!l){g.error("Product not found");return}try{const f={id:l.id,title:l.title,shop_name:l.shopName,url:l.url,currency_key:l.currency,price:l.price,rating:l.rating||0,photos:l.photos||l.images.map(B=>({id:0,url:B}))},j=await U.post("https://socialdash.leverageindo.group/api/products/action",{action:"delete",data:f},{headers:{Authorization:m,"Content-Type":"application/json"}});t(Z(n)),g.success("Product deleted successfully")}catch(f){console.error("Error deleting product:",f),g.error(((i=(h=f.response)==null?void 0:h.data)==null?void 0:i.message)||"Failed to delete product")}},C=n=>{d(n),o(!0)};return s("div",{className:"space-y-6",children:[s("div",{children:[e("h1",{className:"font-bold text-2xl text-slate-900 dark:text-[#eee] mb-2",children:"Products"}),e("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"Easily manage your products \u2014 add, edit, or remove them."})]}),e("button",{onClick:R,className:"text-slate-600 dark:text-slate-300 hover:text-primary-500 border border-slate-300 rounded-[6px] px-4 py-2 transition-colors",children:"+ Add Product"}),N?s("div",{className:"bg-white dark:bg-slate-800 rounded-[6px] p-6 border border-slate-200 dark:border-slate-700 flex flex-col items-center justify-center min-h-[300px]",children:[e(S,{icon:"line-md:loading-twotone-loop",className:"text-6xl text-slate-400 dark:text-slate-500 mb-4"}),e("p",{className:"text-slate-500 dark:text-slate-400",children:"Loading..."})]}):b.length>0?s("div",{className:"bg-white dark:bg-slate-800 rounded-[6px] border border-slate-200 dark:border-slate-700 overflow-x-hidden",children:[s("div",{className:"grid grid-cols-12 gap-4 px-6 py-4 max-sm:px-3 bg-slate-50 dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700",children:[e("div",{className:"col-span-5 max-sm:col-span-4",children:e("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:"Name"})}),e("div",{className:"col-span-3 text-center",children:e("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:"Price"})}),e("div",{className:"col-span-3 max-sm:col-span-2 text-center",children:e("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:"Ratings"})}),e("div",{className:"col-span-1"})]}),e("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:b.map(n=>s("div",{className:"grid grid-cols-12 gap-4 px-6 py-4 max-sm:px-3 transition-colors",children:[s("div",{className:"col-span-5 max-sm:col-span-4 flex items-center gap-3 overflow-x-auto",children:[n.thumbnail&&e("img",{src:n.thumbnail,alt:n.title,className:"w-12 h-12 object-cover rounded-[6px] border border-slate-200 dark:border-slate-700",onError:m=>{m.target.src="https://via.placeholder.com/48?text=No+Image"}}),e("span",{className:"text-sm font-medium text-slate-900 dark:text-[#eee]",children:n.title})]}),e("div",{className:"col-span-3 text-center flex items-center justify-center",children:s("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:[n.price," ",n.currency]})}),e("div",{className:"col-span-3 max-sm:col-span-2 text-center flex items-center justify-center",children:e("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:n.rating||"-"})}),s("div",{className:"col-span-1 max-sm:col-span-3 flex items-center justify-end gap-2",children:[e("button",{onClick:()=>C(n),className:"p-2 max-sm:p-0 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-[6px] transition-colors",title:"Edit product",children:e(S,{icon:"heroicons-outline:pencil",className:"text-xl text-slate-600 dark:text-slate-300"})}),e("button",{onClick:()=>w(n.id),className:"p-2 max-sm:p-0 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-[6px] transition-colors",title:"Delete product",children:e(S,{icon:"heroicons-outline:trash",className:"text-xl text-red-600 dark:text-red-400"})})]})]},n.id))})]}):s("div",{className:"bg-white dark:bg-slate-800 rounded-[6px] p-6 border border-slate-200 dark:border-slate-700 flex flex-col items-center justify-center min-h-[300px]",children:[e(S,{icon:"heroicons-outline:chart-bar",className:"text-6xl text-slate-400 dark:text-slate-500 mb-4"}),e("h3",{className:"font-bold text-xl text-slate-900 dark:text-[#eee] mb-2",children:"No data yet."}),e("p",{className:"text-slate-500 dark:text-slate-400 text-center max-w-md",children:"No products have been added yet. Start by adding your first product!"})]}),e(se,{activeModal:c,onClose:D,editingProduct:F})]})};export{de as default};

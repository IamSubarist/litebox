import{B as I,G as R,r,Q as m,j as d,a as t,L as j,H as q,J as A}from"./index.5f115b8c.js";import{T as k}from"./Textinput.ba68f11d.js";import{u as C}from"./index.esm.652361f4.js";import{c as P,a as v,o as F}from"./object.90d185fb.js";import{C as J}from"./Checkbox.f4ed0e58.js";const V="https://socialdash.leverageindo.group/api",$=P({email:v().email("Invalid email").required("Email is Required"),password:v().required("Password is Required").max(30,"Password shouldn't be more than 30 characters")}).required(),z=a=>!a||a.trim()===""?!0:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a),M=()=>{const a=I(),{register:i,formState:{errors:u},handleSubmit:E,watch:N}=C({resolver:F($),mode:"all"}),T=R(),[n,p]=r.exports.useState(!1),[l,L]=r.exports.useState(!1),[h,f]=r.exports.useState(!1),s=N("email"),x=r.exports.useRef("");return r.exports.useEffect(()=>{n&&setTimeout(()=>{p(!1)},1500)},[n]),r.exports.useEffect(()=>{s&&s.trim()!==""&&s!==x.current&&!z(s)&&m.error("This doesn't look like an email"),x.current=s||""},[s]),d("form",{onSubmit:E(async c=>{var g,w,b,y,S;if(!l){m.error("Please accept terms and conditions"),p(!0);return}f(!0);try{const e=await q.post(`${V}/auth`,{login:c.email,password:c.password},{headers:{"Content-Type":"application/json"}}),o=e.headers.Authorization||e.headers.authorization||e.headers["X-Auth-Token"]||e.headers["x-auth-token"];if(o)localStorage.setItem("authToken",o),(g=e.data)!=null&&g.user&&localStorage.setItem("userInfo",JSON.stringify(e.data.user)),localStorage.setItem("user",JSON.stringify({email:c.email,isAuthenticated:!0})),a(A(!0)),setTimeout(()=>{T("/dashboard")},1500);else throw new Error("Token not received from server")}catch(e){const o=((b=(w=e.response)==null?void 0:w.data)==null?void 0:b.message)||((S=(y=e.response)==null?void 0:y.data)==null?void 0:S.error)||"Invalid credentials";m.error(o)}finally{f(!1)}}),className:"space-y-4 ",children:[t(k,{name:"email",label:"email",type:"email",placeholder:"Enter your email",register:i,error:u.email,className:"h-[48px] rounded-[4px]",maxLength:255}),t(k,{name:"password",label:"password",type:"password",placeholder:"Enter your password",register:i,error:u.password,className:"h-[48px] rounded-[4px]",hasicon:!0,maxLength:30}),d("div",{className:"flex flex-col-reverse sm:flex-row sm:justify-between sm:items-center gap-3 sm:gap-0",children:[t("div",{className:"flex-1 min-w-0 sm:pr-2",children:t(J,{value:l,onChange:()=>L(!l),label:"I accept the terms and privacy policy",error:n})}),d(j,{to:"/forgot-password",className:"text-sm text-slate-800 dark:text-slate-400 leading-6 font-medium whitespace-nowrap sm:ml-2",children:["Forgot Password?"," "]})]}),t("button",{type:"submit",disabled:h,className:"h-[48px] btn btn-dark block w-full text-center rounded-[4px] disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Signing in...":"Sign in"})]})};export{M as L};

import{B as U,G as X,r as o,Q as h,j as y,a as s,R as W,H as j,J as Y}from"./index.5f115b8c.js";import{T as $}from"./Textinput.ba68f11d.js";import{u as D}from"./index.esm.652361f4.js";import{c as F,a as L,o as A}from"./object.90d185fb.js";import{C as Z}from"./Checkbox.f4ed0e58.js";const I="https://socialdash.leverageindo.group/api",ee=c=>!c||c.trim()===""?!0:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c),te=F({email:L().email("Invalid email").required("Email is Required")}).required(),ae=F({password:L().min(6,"Password must be at least 6 characters").max(30,"Password shouldn't be more than 30 characters").required("Please enter password")}).required(),se=({value:c,onChange:E,error:d})=>{const l=o.exports.useRef([]),[m,N]=o.exports.useState(["","","","","",""]);o.exports.useEffect(()=>{if(c){const r=c.split("").slice(0,6),t=[...m];r.forEach((e,i)=>{t[i]=e}),N(t)}},[c]);const P=(r,t)=>{var v;const e=t.target.value.replace(/[^0-9]/g,"");if(e.length>1)return;const i=[...m];i[r]=e,N(i),E(i.join("")),e&&r<5&&((v=l.current[r+1])==null||v.focus())},C=(r,t)=>{var e;t.key==="Backspace"&&!m[r]&&r>0&&((e=l.current[r-1])==null||e.focus())},T=r=>{var v;r.preventDefault();const t=r.clipboardData.getData("text").replace(/[^0-9]/g,"").slice(0,6),e=[...m];t.split("").forEach((u,p)=>{p<6&&(e[p]=u)}),N(e),E(e.join(""));const i=Math.min(t.length,5);(v=l.current[i])==null||v.focus()};return y("div",{className:"space-y-3 w-full max-w-full overflow-x-hidden px-2",children:[s("label",{className:"form-label block capitalize text-center",children:"Enter your OTP Code"}),s("div",{className:"flex gap-1 sm:gap-2 justify-center flex-wrap",children:m.map((r,t)=>s("input",{ref:e=>l.current[t]=e,type:"text",inputMode:"numeric",maxLength:1,value:r,onChange:e=>P(t,e),onKeyDown:e=>C(t,e),onPaste:T,className:`form-control form-label w-10 h-10 sm:w-12 sm:h-12 text-center text-lg sm:text-xl font-semibold border rounded-lg focus:outline-none focus:ring-1 focus:ring-primary-500 flex-shrink-0 ${d?"border-danger-500":"border-slate-300 dark:border-slate-600"}  dark:text-white`},t))}),d&&s("div",{className:"text-danger-500 block text-sm mt-2",children:d})]})},ce=()=>{const c=U(),E=X(),[d,l]=o.exports.useState(1),[m,N]=o.exports.useState(!1),[P,C]=o.exports.useState(!1),[T,r]=o.exports.useState(""),[t,e]=o.exports.useState(""),[i,v]=o.exports.useState(""),[u,p]=o.exports.useState(!1),[_,O]=o.exports.useState(""),{register:q,formState:{errors:B},handleSubmit:M,watch:V}=D({resolver:A(te),mode:"all"}),S=V("email"),R=o.exports.useRef("");o.exports.useEffect(()=>{P&&setTimeout(()=>{C(!1)},1500)},[P]),o.exports.useEffect(()=>{S&&S.trim()!==""&&S!==R.current&&!ee(S)&&h.error("This doesn't look like an email"),R.current=S||""},[S]);const{register:z,formState:{errors:H},handleSubmit:J}=D({resolver:A(ae),mode:"all"}),K=async n=>{var g,w,x,b;if(!m){h.error("Please accept terms and conditions"),C(!0);return}p(!0);try{const f=await j.post(`${I}/auth/confirm_email?recovery=false`,{login:n.email},{headers:{"Content-Type":"application/json"}});r(n.email),l(2),h.success("OTP code sent to your email")}catch(f){const a=((w=(g=f.response)==null?void 0:g.data)==null?void 0:w.message)||((b=(x=f.response)==null?void 0:x.data)==null?void 0:b.error)||"Failed to send OTP code";h.error(a)}finally{p(!1)}},G=async()=>{var n,g,w,x,b,f;if(t.length!==6){O("Please enter complete OTP code"),h.error("Please enter complete OTP code");return}p(!0),O("");try{const a=await j.post(`${I}/auth/confirm_email?recovery=false&code=${t}`,{login:T},{headers:{"Content-Type":"application/json"}});if((g=(n=a.data)==null?void 0:n.data)!=null&&g.hash)v(a.data.data.hash),l(3),h.success(a.data.message||"Email confirmed successfully");else throw new Error("Hash not received from server")}catch(a){const k=((x=(w=a.response)==null?void 0:w.data)==null?void 0:x.message)||((f=(b=a.response)==null?void 0:b.data)==null?void 0:f.error)||"Invalid OTP code";O(k),h.error(k)}finally{p(!1)}},Q=async n=>{var g,w,x,b,f;if(!i){h.error("Session expired. Please start again."),l(1);return}p(!0);try{const a=await j.post(`${I}/auth/create_user?guard_hash=${i}`,{login:T,password:n.password},{headers:{"Content-Type":"application/json"}}),k=a.headers.Authorization||a.headers.authorization||a.headers["X-Auth-Token"]||a.headers["x-auth-token"];if(k)localStorage.setItem("authToken",k),(g=a.data)!=null&&g.user&&localStorage.setItem("userInfo",JSON.stringify(a.data.user)),localStorage.setItem("user",JSON.stringify({email:T,isAuthenticated:!0})),c(Y(!0)),setTimeout(()=>{E("/dashboard")},1500);else throw new Error("Token not received from server")}catch(a){const k=((x=(w=a.response)==null?void 0:w.data)==null?void 0:x.message)||((f=(b=a.response)==null?void 0:b.data)==null?void 0:f.error)||"Failed to create account";h.error(k)}finally{p(!1)}};return y("div",{className:"space-y-5 w-full max-w-full",children:[s("div",{className:"flex items-center justify-center gap-2 mb-6 flex-wrap",children:[1,2,3].map(n=>y(W.Fragment,{children:[s("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-semibold flex-shrink-0 ${d>=n?"bg-primary-500 text-white":"bg-slate-200 dark:bg-slate-700 text-slate-500"}`,children:n}),n<3&&s("div",{className:`h-1 w-8 sm:w-12 flex-shrink-0 ${d>n?"bg-primary-500":"bg-slate-200 dark:bg-slate-700"}`})]},n))}),d===1&&y("form",{onSubmit:M(K),className:"space-y-5 w-full max-w-full",children:[s($,{name:"email",label:"email",type:"email",placeholder:" Enter your email",register:q,error:B.email,className:"h-[48px] w-full",maxLength:255}),s("div",{className:"w-full max-w-full",children:s(Z,{label:"I accept the terms and privacy policy",value:m,onChange:()=>N(!m),error:P})}),s("button",{type:"submit",disabled:u,className:"btn btn-dark block w-full text-center disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Sending...":"Continue"})]}),d===2&&y("div",{className:"space-y-5 w-full max-w-full overflow-x-hidden",children:[s("div",{className:"w-full text-center flex items-center justify-center",children:s(se,{value:t,onChange:e,error:_})}),y("div",{className:"flex gap-2 sm:gap-3 flex-wrap",children:[s("button",{type:"button",onClick:()=>{l(1),e(""),O("")},className:"btn btn-outline-dark flex-1 min-w-0",disabled:u,children:"Back"}),s("button",{type:"button",onClick:G,disabled:t.length!==6||u,className:"btn btn-dark flex-1 min-w-0 disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Verifying...":"Continue"})]})]}),d===3&&y("form",{onSubmit:J(Q),className:"space-y-5 w-full max-w-full overflow-x-hidden",children:[s($,{name:"password",label:"password",type:"password",placeholder:" Enter your password",register:z,error:H.password,className:"h-[48px] w-full",hasicon:!0,maxLength:30}),y("div",{className:"flex gap-2 sm:gap-3 flex-wrap",children:[s("button",{type:"button",onClick:()=>l(2),className:"btn btn-outline-dark flex-1 min-w-0",children:"Back"}),s("button",{type:"submit",disabled:u,className:"btn btn-dark flex-1 min-w-0 disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Creating...":"Create an account"})]})]})]})};export{ce as R};

import{G as K,r as l,Q as p,j as y,a,R as z,H as j}from"./index.5f115b8c.js";import{T as $}from"./Textinput.ba68f11d.js";import{u as F}from"./index.esm.652361f4.js";import{c as D,a as _,o as I}from"./object.90d185fb.js";const R="https://socialdash.leverageindo.group/api",G=c=>!c||c.trim()===""?!0:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c),Q=D({email:_().email("Invalid email").required("Email is Required")}).required(),U=D({password:_().min(6,"Password must be at least 6 characters").max(30,"Password shouldn't be more than 30 characters").required("Please enter password")}).required(),J=({value:c,onChange:i,error:d})=>{const w=l.exports.useRef([]),[x,u]=l.exports.useState(["","","","","",""]);l.exports.useEffect(()=>{if(c){const e=c.split("").slice(0,6),t=[...x];e.forEach((s,n)=>{t[n]=s}),u(t)}},[c]);const P=(e,t)=>{var v;const s=t.target.value.replace(/[^0-9]/g,"");if(s.length>1)return;const n=[...x];n[e]=s,u(n),i(n.join("")),s&&e<5&&((v=w.current[e+1])==null||v.focus())},k=(e,t)=>{var s;t.key==="Backspace"&&!x[e]&&e>0&&((s=w.current[e-1])==null||s.focus())},T=e=>{var v;e.preventDefault();const t=e.clipboardData.getData("text").replace(/[^0-9]/g,"").slice(0,6),s=[...x];t.split("").forEach((O,E)=>{E<6&&(s[E]=O)}),u(s),i(s.join(""));const n=Math.min(t.length,5);(v=w.current[n])==null||v.focus()};return y("div",{className:"space-y-3",children:[a("label",{className:"form-label block capitalize text-center",children:"Enter your OTP Code"}),a("div",{className:"flex gap-2 justify-center",children:x.map((e,t)=>a("input",{ref:s=>w.current[t]=s,type:"text",inputMode:"numeric",maxLength:1,value:e,onChange:s=>P(t,s),onKeyDown:s=>k(t,s),onPaste:T,className:`form-control form-label w-12 h-12 text-center text-xl font-semibold border rounded-lg focus:outline-none focus:ring-1 focus:ring-primary-500 ${d?"border-danger-500":"border-slate-300 dark:border-slate-600"}  dark:text-white`},t))}),d&&a("div",{className:"text-danger-500 block text-sm mt-2",children:d})]})},ee=()=>{const c=K(),[i,d]=l.exports.useState(1),[w,x]=l.exports.useState(""),[u,P]=l.exports.useState(""),[k,T]=l.exports.useState(""),[e,t]=l.exports.useState(!1),[s,n]=l.exports.useState(""),{register:v,formState:{errors:O},handleSubmit:E,watch:q}=F({resolver:I(Q),mode:"all"}),S=q("email"),C=l.exports.useRef("");l.exports.useEffect(()=>{S&&S.trim()!==""&&S!==C.current&&!G(S)&&p.error("This doesn't look like an email"),C.current=S||""},[S]);const{register:L,formState:{errors:M},handleSubmit:B}=F({resolver:I(U),mode:"all"}),V=async r=>{var h,f,g,b;t(!0);try{const m=await j.post(`${R}/auth/confirm_email?recovery=true`,{login:r.email},{headers:{"Content-Type":"application/json"}});x(r.email),d(2),p.success("OTP code sent to your email")}catch(m){const o=((f=(h=m.response)==null?void 0:h.data)==null?void 0:f.message)||((b=(g=m.response)==null?void 0:g.data)==null?void 0:b.error)||"Failed to send OTP code";p.error(o)}finally{t(!1)}},A=async()=>{var r,h,f,g,b,m;if(u.length!==6){n("Please enter complete OTP code"),p.error("Please enter complete OTP code");return}t(!0),n("");try{const o=await j.post(`${R}/auth/confirm_email?recovery=true&code=${u}`,{login:w},{headers:{"Content-Type":"application/json"}});if((h=(r=o.data)==null?void 0:r.data)!=null&&h.hash)T(o.data.data.hash),d(3),p.success(o.data.message||"Email confirmed successfully");else throw new Error("Hash not received from server")}catch(o){const N=((g=(f=o.response)==null?void 0:f.data)==null?void 0:g.message)||((m=(b=o.response)==null?void 0:b.data)==null?void 0:m.error)||"Invalid OTP code";n(N),p.error(N)}finally{t(!1)}},H=async r=>{var h,f,g,b,m;if(!k){p.error("Session expired. Please start again."),d(1);return}t(!0);try{const o=await j.post(`${R}/auth/password_recovery?guard_hash=${k}`,{login:w,password:r.password},{headers:{"Content-Type":"application/json"}});p.success(((h=o.data)==null?void 0:h.message)||"Password recovered successfully"),setTimeout(()=>{c("/")},1500)}catch(o){const N=((g=(f=o.response)==null?void 0:f.data)==null?void 0:g.message)||((m=(b=o.response)==null?void 0:b.data)==null?void 0:m.error)||"Failed to recover password";p.error(N)}finally{t(!1)}};return y("div",{className:"space-y-5",children:[a("div",{className:"flex items-center justify-center gap-2 mb-6",children:[1,2,3].map(r=>y(z.Fragment,{children:[a("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-semibold ${i>=r?"bg-primary-500 text-white":"bg-slate-200 dark:bg-slate-700 text-slate-500"}`,children:r}),r<3&&a("div",{className:`h-1 w-12 ${i>r?"bg-primary-500":"bg-slate-200 dark:bg-slate-700"}`})]},r))}),i===1&&y("form",{onSubmit:E(V),className:"space-y-5",children:[a($,{name:"email",label:"email",type:"email",placeholder:" Enter your email",register:v,error:O.email,className:"h-[48px]",maxLength:255}),a("button",{type:"submit",disabled:e,className:"btn btn-dark block w-full text-center disabled:opacity-50 disabled:cursor-not-allowed",children:e?"Sending...":"Send recovery email"})]}),i===2&&y("div",{className:"space-y-5",children:[a("div",{className:"w-full text-center flex items-center justify-center",children:a(J,{value:u,onChange:P,error:s})}),y("div",{className:"flex gap-3",children:[a("button",{type:"button",onClick:()=>{d(1),P(""),n("")},className:"btn btn-outline-dark flex-1",disabled:e,children:"Back"}),a("button",{type:"button",onClick:A,disabled:u.length!==6||e,className:"btn btn-dark flex-1 disabled:opacity-50 disabled:cursor-not-allowed",children:e?"Verifying...":"Continue"})]})]}),i===3&&y("form",{onSubmit:B(H),className:"space-y-5",children:[a($,{name:"password",label:"New password",type:"password",placeholder:" Enter your new password",register:L,error:M.password,className:"h-[48px]",hasicon:!0,maxLength:30}),y("div",{className:"flex gap-3",children:[a("button",{type:"button",onClick:()=>d(2),className:"btn btn-outline-dark flex-1",disabled:e,children:"Back"}),a("button",{type:"submit",disabled:e,className:"btn btn-dark flex-1 disabled:opacity-50 disabled:cursor-not-allowed",children:e?"Recovering...":"Recover password"})]})]})]})};export{ee as F};
